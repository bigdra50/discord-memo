# Discord個人データ保存Bot - 要件定義・仕様書

## プロジェクト概要

### 目的

Discordサーバー内で、各ユーザーが個人的なデータ（メモ、パスワード、リンクなど）を安全に保存・管理できるbotを作成する。

### 対象ユーザー

- 10人以下の小規模Discordサーバーメンバー
- 個人的なデータを一時的に保存したいユーザー

### 基本方針

- **プライバシー重視**: 全てのデータ操作は本人にのみ表示
- **シンプル**: 直感的で分かりやすいコマンド
- **安全性**: ユーザー間でのデータ分離

## 機能要件

### 1. データ保存機能

**コマンド**: `/save <name> <value>`

**機能詳細**:

- ユーザーが指定した名前（キー）と値のペアを保存
- 同じユーザーの既存データは上書き
- 文字数制限: name（50文字）、value（1000文字）
- 保存可能データ数: ユーザーあたり最大50件

**入力例**:

```
/save password MySecretPassword123
/save memo 明日のミーティング資料をチェック
/save url https://example.com/important-link
```

**出力**:

- 成功時: 保存完了メッセージ（ephemeral）
- 失敗時: エラーメッセージ（ephemeral）

### 2. データ取得機能

**コマンド**: `/get [name]`

**機能詳細**:

- `name`を指定: 該当データの値を表示
- `name`を省略: 保存された全データを一覧表示
- 存在しないデータ名の場合はエラーメッセージ

**入力例**:

```
/get password
/get  # 全データ表示
```

**出力**:

- 指定データまたは全データリスト（ephemeral）
- データが存在しない場合の案内メッセージ

### 3. データ削除機能

**コマンド**: `/delete <name>`

**機能詳細**:

- 指定した名前のデータを削除
- 存在しないデータ名の場合はエラーメッセージ
- 削除前の確認は不要（シンプル性重視）

**入力例**:

```
/delete password
```

**出力**:

- 削除完了または失敗メッセージ（ephemeral）

### 4. データ一覧表示機能

**コマンド**: `/list`

**機能詳細**:

- 保存されているデータ名の一覧を表示
- データ件数も表示
- 値は表示しない（セキュリティ考慮）

**出力例**:

```
📝 データ一覧
• password
• memo
• url

合計 3件のデータ
```

## 非機能要件

### セキュリティ要件

- **データ分離**: ユーザー間でのデータアクセス不可
- **プライベート表示**: 全応答をephemeral（本人のみ表示）
- **データ暗号化**: 本格運用時は暗号化を検討
- **アクセス制御**: botの管理者権限設定

### パフォーマンス要件

- **応答時間**: コマンド実行から1秒以内の応答
- **同時利用**: 10人が同時利用可能
- **データ処理**: 1ユーザーあたり50件のデータを高速処理

### 可用性要件

- **稼働率**: 99%以上（クラウドサービス利用）
- **バックアップ**: データファイルの定期バックアップ
- **復旧時間**: 障害発生時1時間以内の復旧

### 拡張性要件

- **ユーザー数**: 将来的に100人程度まで対応可能な設計
- **機能追加**: 新コマンドの追加が容易な構造
- **データ移行**: JSONからデータベースへの移行可能性

## 技術仕様

### 開発環境

- **言語**: Python 3.11+
- **パッケージマネージャー**: uv
- **主要ライブラリ**: discord.py 2.3.2+
- **設定管理**: python-dotenv（開発時）

### データ構造

```json
{
  "user_id_1": {
    "data_name_1": "value_1",
    "data_name_2": "value_2"
  },
  "user_id_2": {
    "data_name_1": "value_1"
  }
}
```

### ファイル構成

```
discord-private-bot/
├── pyproject.toml          # uv設定・依存関係
├── bot.py                  # メインbotコード
├── user_data.json          # データファイル（実行時生成）
├── .env                    # 環境変数（開発用）
├── .gitignore             # Git除外設定
├── README.md              # 使用方法説明
└── requirements.txt       # クラウドデプロイ用（生成）
```

### デプロイ環境

- **プラットフォーム**: Railway（推奨）
- **バックアップ**: 定期的なデータファイルダウンロード
- **監視**: Railway の標準ログ機能

## エラーハンドリング

### 入力エラー

- 文字数超過
- 不正な文字（特殊文字制限）
- 空の入力値

### システムエラー

- ファイル読み書きエラー
- Discord API接続エラー
- メモリ不足

### ユーザーエラー

- 存在しないデータ名指定
- 権限不足
- コマンド構文エラー

## セキュリティ考慮事項

### データ保護

- ユーザーIDによる完全なデータ分離
- ファイルアクセス権限の適切な設定
- ログファイルへの機密情報出力防止

### Discord固有の考慮

- ephemeral応答の確実な実装
- botの権限最小化
- 悪用防止のためのレート制限

## 運用・保守

### 日常運用

- データファイルの定期バックアップ（週1回）
- ログの監視（エラー発生時の通知）
- リソース使用量のチェック

### 緊急時対応

- サービス停止時の復旧手順
- データ消失時の復元手順
- 不正アクセス発見時の対応

### アップデート

- 新機能追加時の手順
- discord.py ライブラリ更新時の検証
- データ構造変更時の移行手順

## 制限事項

### 現在の制限

- データは暗号化されていない
- データベース未使用（JSONファイル）
- 高度な検索機能なし
- データのエクスポート機能なし

### 将来の改善案

- データ暗号化の実装
- PostgreSQL等のデータベース導入
- データ検索・フィルタ機能
- データエクスポート/インポート機能
- データの有効期限設定

## 成功指標

### 利用指標

- アクティブユーザー数: 月5人以上
- 1ユーザーあたりの保存データ数: 平均5件以上
- コマンド実行成功率: 95%以上

### 技術指標

- システム稼働率: 99%以上
- 応答時間: 1秒以内
- エラー発生率: 1%未満

## 用語集

- **ephemeral**: Discordで本人にのみ表示される応答方式
- **slash command**: Discordの新しいコマンド形式（/で始まる）
- **uv**: 高速なPythonパッケージマネージャー
- **Railway**: Webアプリケーションデプロイプラットフォーム
